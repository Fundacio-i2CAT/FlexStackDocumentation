

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cooperative Awareness (CA) Basic Service &mdash; FlexStack 0.9.6 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=7430def1"></script>
      <script src="../../_static/doctools.js?v=888ff710"></script>
      <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="VRU Awareness Service" href="vru_awareness_service.html" />
    <link rel="prev" title="Utils" href="../utils.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            FlexStack
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">FlexStack(R) Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../overview.html#modules">Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started.html#setting-up-the-example">Setting up the example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started.html#logging">Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started.html#location-service">Location Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started.html#link-layer">Link Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started.html#geonetworking">GeoNetworking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started.html#btp">BTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting_started.html#facilities-layer">Facilities Layer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started.html#complete-script">Complete Script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture.html">FlexStack Architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FlexStack(R) Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../link_layer.html">Link Layer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../link_layer.html#cv2xlinklayer">CV2XLinkLayer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../link_layer.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../link_layer.html#components">Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="../link_layer.html#building-the-library">Building the Library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../link_layer.html#complete-script">Complete Script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../geonetworking.html">GeoNetworking (GN)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../geonetworking.html#diagram">Diagram</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geonetworking.html#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../geonetworking.html#router-instantiation">Router Instantiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geonetworking.html#request-sending-geonetworking-packet">Request Sending GeoNetworking Packet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geonetworking.html#receiving-geonetworking-packet">Receiving GeoNetworking Packet</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../btp.html">Basic Transport Protocol (BTP)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../btp.html#diagram">Diagram</a></li>
<li class="toctree-l2"><a class="reference internal" href="../btp.html#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../btp.html#router-instantiation">Router Instantiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../btp.html#request-sending-btp-packet">Request Sending BTP Packet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../btp.html#response-receiving-btp-packet">Response Receiving BTP Packet</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../btp.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../applications.html">Applications Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">Utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Facilities Services</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cooperative Awareness (CA) Basic Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#diagram">Diagram</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-script-sending-and-receiving-cams">Basic Script sending and receiving CAMs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vru_awareness_service.html">VRU Awareness Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="vru_awareness_service.html#vru-awareness-messages-overview">VRU Awareness Messages Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="vru_awareness_service.html#vru-basic-service-management">VRU Basic Service Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="vru_awareness_service.html#vru-cluster-management">VRU Cluster Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="vru_awareness_service.html#vam-reception-management">VAM Reception Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="vru_awareness_service.html#vam-transmission-management">VAM Transmission Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="vru_awareness_service.html#vam-encoding-decoding">VAM Encoding &amp; Decoding</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="vru_awareness_service.html#quickstart">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="vru_awareness_service.html#interfacing-with-the-vru-basic-service">Interfacing with the VRU Basic Service</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="den_service.html">Decentralized Environmental Notification (DEN) Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="den_service.html#denm-overview">DENM Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="den_service.html#den-service">DEN Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="den_service.html#den-reception-management">DEN Reception Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="den_service.html#den-transmission-management">DEN Transmission Management</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="den_service.html#application-layer-emergency-vehicle-approaching-service">Application Layer: Emergency Vehicle Approaching Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="den_service.html#quickstart">Quickstart</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="local_dynamic_map.html">Local Dynamic Map</a><ul>
<li class="toctree-l2"><a class="reference internal" href="local_dynamic_map.html#local-dynamic-map-overview">Local Dynamic Map Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="local_dynamic_map.html#local-dynamic-map-service">Local Dynamic Map Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="local_dynamic_map.html#local-dynamic-map-maintenance">Local Dynamic Map Maintenance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="local_dynamic_map.html#ldm-declaration">LDM Declaration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="local_dynamic_map.html#ldm-data-providers">LDM Data Providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="local_dynamic_map.html#ldm-data-consumers">LDM Data Consumers</a></li>
<li class="toctree-l3"><a class="reference internal" href="local_dynamic_map.html#ldm-data-object">LDM Data Object</a></li>
<li class="toctree-l3"><a class="reference internal" href="local_dynamic_map.html#ldm-area-of-maintenance">LDM Area of Maintenance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="local_dynamic_map.html#local-dynamic-map-interfacing-options">Local Dynamic Map Interfacing Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="local_dynamic_map.html#ldm-publish-interface">LDM Publish Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="local_dynamic_map.html#ldm-query-interface">LDM Query Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="local_dynamic_map.html#ldm-publish-subscribe-interface">LDM Publish/Subscribe Interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="local_dynamic_map.html#quickstart">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="local_dynamic_map.html#interfacing-with-the-vru-basic-service">Interfacing with the VRU Basic Service</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/docker-deployment.html">Docker Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/rawlinklayer-ethernet-deployment.html">Sending and Recieving V2X Messages Through Ethernet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/logging.html">Logging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/logging.html#logging-configuration">Logging Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/logging.html#simple-configuration-logging">Simple Configuration Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/logging.html#file-configuration-logging">File Configuration Logging</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">FlexStack</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Cooperative Awareness (CA) Basic Service</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/modules/facilities/ca_basic_service.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cooperative-awareness-ca-basic-service">
<h1>Cooperative Awareness (CA) Basic Service<a class="headerlink" href="#cooperative-awareness-ca-basic-service" title="Permalink to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>The FlexStack comes with an implementation of the Cooperative Awareness (CA) Basic Service based on the standard ETSI TS 103 900 V2.1.1 (2023-11).
This service disseminates and processes the so-called Cooperative Awareness Messages (CAM)s that contain information about the sending vehicle, such as its position, speed, or heading
with additional descriptive information like vehicle length or width.</p>
<p>The implementation provided by the FlexStack Community Edition sends those messages whenever the Location Service (see <span class="xref std std-ref">location_service</span>) provides a new location update.
Also processes those messages on reception and provides the information to the Location Data Management (LDM) (see <span class="xref std std-ref">ldm</span>).</p>
</section>
<section id="diagram">
<h2>Diagram<a class="headerlink" href="#diagram" title="Permalink to this heading"></a></h2>
<img alt="Cooperative Awareness Basic Service" src="../../_images/ca_basic_service.png" />
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p>To instantiate the Cooperative Awareness Basic Service, you need to import the following modules.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">flexstack.facilities.ca_basic_service.ca_basic_service</span><span class="w"> </span><span class="kn">import</span> <span class="n">CooperativeAwarenessBasicService</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flexstack.facilities.ca_basic_service.cam_transmission_management</span><span class="w"> </span><span class="kn">import</span> <span class="n">VehicleData</span>
</pre></div>
</div>
<p>On one side there is the CooperativeAwarenessBasicService class that literally carries the implementation of that service.
On the other side, there is the VehicleData class that contains the information about the sending vehicle.
The VehicleData must be passed to the CooperativeAwarenessBasicService constructor with the vehicle’s parameters.
To configure the vehicle data class its parameters can be set following the format specified in the ETSI TS 102 894-2 V2.3.1 (2024-08) standard.
Here a basic example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vehicle_data</span> <span class="o">=</span> <span class="n">VehicleData</span><span class="p">()</span>
<span class="n">station_id</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Station Id of the ITS PDU Header</span>
<span class="n">station_type</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Station Type as specified in ETSI TS 102 894-2 V2.3.1 (2024-08)</span>
<span class="n">drive_direction</span> <span class="o">=</span> <span class="s2">&quot;unavailable&quot;</span>
<span class="n">vehicle_length</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;vehicleLengthValue&quot;</span><span class="p">:</span> <span class="mi">1023</span><span class="p">,</span> <span class="c1"># as specified in ETSI TS 102 894-2 V2.3.1 (2024-08)</span>
    <span class="s2">&quot;vehicleLengthConfidenceIndication&quot;</span><span class="p">:</span> <span class="s2">&quot;unavailable&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">vehicle_width</span> <span class="o">=</span> <span class="mi">62</span>
</pre></div>
</div>
<p>Before instantiating the CooperativeAwarenessBasicService, you need to have a Location Data Management (LDM) (see: <span class="xref std std-ref">local_dynamic_map</span>) instance and a BTP Router instance (see: <span class="xref std std-ref">btp_router</span>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ca_basic_service</span> <span class="o">=</span> <span class="n">CooperativeAwarenessBasicService</span><span class="p">(</span>
    <span class="n">btp_router</span><span class="o">=</span><span class="n">btp_router</span><span class="p">,</span>
    <span class="n">vehicle_data</span><span class="o">=</span><span class="n">vehicle_data</span><span class="p">,</span>
    <span class="n">ldm</span> <span class="o">=</span> <span class="n">ldm</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Once the service has been instantiated it will start automatically processing all the incoming Cooperative Awareness Messages (CAMs), but to send the CAMs you need to add a callback to the Location Service (see: <span class="xref std std-ref">location_service</span>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">location_service</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">ca_basic_service</span><span class="o">.</span><span class="n">cam_transmission_management</span><span class="o">.</span><span class="n">location_service_callback</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="basic-script-sending-and-receiving-cams">
<h2>Basic Script sending and receiving CAMs<a class="headerlink" href="#basic-script-sending-and-receiving-cams" title="Permalink to this heading"></a></h2>
<p>Here is a basic script that sends and receives CAMs with a basic Ethernet Layer 2 Linux Interface:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Link Layer Imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flexstack.linklayer.raw_link_layer</span><span class="w"> </span><span class="kn">import</span> <span class="n">RawLinkLayer</span>

<span class="c1"># GeoNetworking imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flexstack.geonet.router</span><span class="w"> </span><span class="kn">import</span> <span class="n">Router</span> <span class="k">as</span> <span class="n">GNRouter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flexstack.geonet.mib</span><span class="w"> </span><span class="kn">import</span> <span class="n">MIB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flexstack.geonet.gn_address</span><span class="w"> </span><span class="kn">import</span> <span class="n">GNAddress</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">ST</span><span class="p">,</span> <span class="n">MID</span>

<span class="c1"># BTP Router imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flexstack.btp.router</span><span class="w"> </span><span class="kn">import</span> <span class="n">Router</span> <span class="k">as</span> <span class="n">BTPRouter</span>

<span class="c1"># Location Service imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flexstack.utils.static_location_service</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadStaticLocationService</span>

<span class="c1"># Local Dynamic Map imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flexstack.facilities.local_dynamic_map.factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ldm_factory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flexstack.facilities.local_dynamic_map.ldm_classes</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Location</span><span class="p">,</span>
    <span class="n">SubscribeDataobjectsReq</span><span class="p">,</span>
    <span class="n">SubscribeDataObjectsResp</span><span class="p">,</span>
    <span class="n">RegisterDataConsumerReq</span><span class="p">,</span>
    <span class="n">RegisterDataConsumerResp</span><span class="p">,</span>
    <span class="n">RequestDataObjectsResp</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flexstack.facilities.local_dynamic_map.ldm_constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">CAM</span>

<span class="c1"># CA Basic Service imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flexstack.facilities.ca_basic_service.ca_basic_service</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">CooperativeAwarenessBasicService</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flexstack.facilities.ca_basic_service.cam_transmission_management</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">VehicleData</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">POSITION_COORDINATES</span> <span class="o">=</span> <span class="p">[</span><span class="mf">41.386931</span><span class="p">,</span> <span class="mf">2.112104</span><span class="p">]</span>

<span class="c1"># Instantiate a Location Service</span>
<span class="n">location_service</span> <span class="o">=</span> <span class="n">ThreadStaticLocationService</span><span class="p">(</span>
    <span class="n">period</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">POSITION_COORDINATES</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">longitude</span><span class="o">=</span><span class="n">POSITION_COORDINATES</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Instantiate a GN router</span>
<span class="n">mac_address</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xaa\xbb\xcc\x11\x21\x31</span><span class="s2">&quot;</span>
<span class="n">mib</span> <span class="o">=</span> <span class="n">MIB</span><span class="p">()</span>
<span class="n">gn_addr</span> <span class="o">=</span> <span class="n">GNAddress</span><span class="p">()</span>
<span class="n">gn_addr</span><span class="o">.</span><span class="n">set_m</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">GN_MULTICAST</span><span class="p">)</span>
<span class="n">gn_addr</span><span class="o">.</span><span class="n">set_st</span><span class="p">(</span><span class="n">ST</span><span class="o">.</span><span class="n">CYCLIST</span><span class="p">)</span>
<span class="n">gn_addr</span><span class="o">.</span><span class="n">set_mid</span><span class="p">(</span><span class="n">MID</span><span class="p">(</span><span class="n">mac_address</span><span class="p">))</span>
<span class="n">mib</span><span class="o">.</span><span class="n">itsGnLocalGnAddr</span> <span class="o">=</span> <span class="n">gn_addr</span>
<span class="n">gn_router</span> <span class="o">=</span> <span class="n">GNRouter</span><span class="p">(</span><span class="n">mib</span><span class="o">=</span><span class="n">mib</span><span class="p">,</span> <span class="n">sign_service</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">location_service</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">gn_router</span><span class="o">.</span><span class="n">refresh_ego_position_vector</span><span class="p">)</span>

<span class="c1"># Instantiate a Link Layer</span>
<span class="n">link_layer</span> <span class="o">=</span> <span class="n">RawLinkLayer</span><span class="p">(</span>
    <span class="s2">&quot;lo&quot;</span><span class="p">,</span> <span class="n">mac_address</span><span class="p">,</span> <span class="n">receive_callback</span><span class="o">=</span><span class="n">gn_router</span><span class="o">.</span><span class="n">gn_data_indicate</span>
<span class="p">)</span>
<span class="n">gn_router</span><span class="o">.</span><span class="n">link_layer</span> <span class="o">=</span> <span class="n">link_layer</span>

<span class="c1"># Instantiate a BTP router</span>
<span class="n">btp_router</span> <span class="o">=</span> <span class="n">BTPRouter</span><span class="p">(</span><span class="n">gn_router</span><span class="p">)</span>
<span class="n">gn_router</span><span class="o">.</span><span class="n">register_indication_callback</span><span class="p">(</span><span class="n">btp_router</span><span class="o">.</span><span class="n">btp_data_indication</span><span class="p">)</span>

<span class="c1"># Instantiate a Local Dynamic Map (LDM)</span>
<span class="n">ldm_location</span> <span class="o">=</span> <span class="n">Location</span><span class="o">.</span><span class="n">initializer</span><span class="p">()</span>
<span class="n">ldm</span> <span class="o">=</span> <span class="n">ldm_factory</span><span class="p">(</span>
    <span class="n">ldm_location</span><span class="p">,</span>
    <span class="n">ldm_maintenance_type</span><span class="o">=</span><span class="s2">&quot;Reactive&quot;</span><span class="p">,</span>
    <span class="n">ldm_service_type</span><span class="o">=</span><span class="s2">&quot;Reactive&quot;</span><span class="p">,</span>
    <span class="n">ldm_database_type</span><span class="o">=</span><span class="s2">&quot;Dictionary&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">location_service</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">ldm_location</span><span class="o">.</span><span class="n">location_service_callback</span><span class="p">)</span>

<span class="c1"># Subscribe to LDM</span>
<span class="n">register_data_consumer_reponse</span><span class="p">:</span> <span class="n">RegisterDataConsumerResp</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ldm</span><span class="o">.</span><span class="n">if_ldm_4</span><span class="o">.</span><span class="n">register_data_consumer</span><span class="p">(</span>
        <span class="n">RegisterDataConsumerReq</span><span class="p">(</span>
            <span class="n">application_id</span><span class="o">=</span><span class="n">CAM</span><span class="p">,</span>
            <span class="n">access_permisions</span><span class="o">=</span><span class="p">[</span><span class="n">CAM</span><span class="p">],</span>
            <span class="n">area_of_interest</span><span class="o">=</span><span class="n">ldm_location</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="k">if</span> <span class="n">register_data_consumer_reponse</span><span class="o">.</span><span class="n">result</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">ldm_subscription_callback</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">RequestDataObjectsResp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># We are printing any received CAM message.</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data_objects</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;dataObject&quot;</span><span class="p">])</span>


<span class="n">subscribe_data_consumer_response</span><span class="p">:</span> <span class="n">SubscribeDataObjectsResp</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ldm</span><span class="o">.</span><span class="n">if_ldm_4</span><span class="o">.</span><span class="n">subscribe_data_consumer</span><span class="p">(</span>
        <span class="n">SubscribeDataobjectsReq</span><span class="p">(</span>
            <span class="n">application_id</span><span class="o">=</span><span class="n">CAM</span><span class="p">,</span>
            <span class="n">data_object_type</span><span class="o">=</span><span class="p">[</span><span class="n">CAM</span><span class="p">],</span>
            <span class="n">priority</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">notify_time</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">multiplicity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">ldm_subscription_callback</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="k">if</span> <span class="n">subscribe_data_consumer_response</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">result</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Failed to subscribe to data objects: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">subscribe_data_consumer_response</span><span class="o">.</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

<span class="c1"># Instantiate a CA Basic Service</span>
<span class="n">vehicle_data</span> <span class="o">=</span> <span class="n">VehicleData</span><span class="p">()</span>
<span class="n">station_id</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Station Id of the ITS PDU Header</span>
<span class="n">station_type</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Station Type as specified in ETSI TS 102 894-2 V2.3.1 (2024-08)</span>
<span class="n">drive_direction</span> <span class="o">=</span> <span class="s2">&quot;forward&quot;</span>
<span class="n">vehicle_length</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;vehicleLengthValue&quot;</span><span class="p">:</span> <span class="mi">1023</span><span class="p">,</span>  <span class="c1"># as specified in ETSI TS 102 894-2 V2.3.1 (2024-08)</span>
    <span class="s2">&quot;vehicleLengthConfidenceIndication&quot;</span><span class="p">:</span> <span class="s2">&quot;unavailable&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">vehicle_width</span> <span class="o">=</span> <span class="mi">62</span>

<span class="n">ca_basic_service</span> <span class="o">=</span> <span class="n">CooperativeAwarenessBasicService</span><span class="p">(</span>
    <span class="n">btp_router</span><span class="o">=</span><span class="n">btp_router</span><span class="p">,</span>
    <span class="n">vehicle_data</span><span class="o">=</span><span class="n">vehicle_data</span><span class="p">,</span>
    <span class="n">ldm</span><span class="o">=</span><span class="n">ldm</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Start sending CAM messages</span>
<span class="n">location_service</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">location_service</span><span class="o">.</span><span class="n">location_service_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../utils.html" class="btn btn-neutral float-left" title="Utils" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="vru_awareness_service.html" class="btn btn-neutral float-right" title="VRU Awareness Service" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, i2CAT Foundation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>